// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//===================== MODEL =======================

//1
model User {
  id        Int               @id @default(autoincrement())
  name      String
  phone     String?
  image     String?           @default("https://haycafe.vn/wp-content/uploads/2023/04/Hinh-anh-avatar-cute-TikTok-nam.jpg")
  email     String            @unique
  gender    GENDER_ENUM_TYPE?
  password  String
  address   String?
  hashedRt  String?
  createdAt DateTime          @default(now()) @map("created_at")
  updatedAt DateTime          @updatedAt @map("updated_at")

  roleId Int
  role   Role? @relation(fields: [roleId], references: [id])

  feedbacks            Feedback[]
  bookings             Booking[]
  customizedComboMenus CustomizedComboMenu[]

  @@map("users")
}

//2
model Role {
  id       Int    @id @default(autoincrement())
  roleName ROLE   @default(CUSTOMER)
  user     User[]

  @@map("roles")
}

//3
model Zone {
  id         Int    @id @default(autoincrement())
  zoneName   String
  numberRoom Int

  bookings Booking[]

  @@map("zones")
}

//4
model Employee {
  id           Int              @id @default(autoincrement())
  employeeName String
  phone        String
  address      String
  salary       Decimal          @db.Decimal(60, 2)
  age          Int
  experience   Int
  gender       GENDER_ENUM_TYPE
  position     POSITION_ENUM
  regency      String

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("employees")
}

//5
model Feedback {
  id      Int    @id @default(autoincrement())
  rating  Int
  comment String

  userId Int
  user   User @relation(fields: [userId], references: [id])

  bookingId Int?     @unique
  booking   Booking? @relation(fields: [bookingId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("feelbacks")
}

model Booking {
  id            Int      @id @default(autoincrement())
  numberOfGuest Int
  depositMoney  Decimal  @db.Decimal(60, 2)
  totalMoney    Decimal  @db.Decimal(60, 2)
  toTime        DateTime @default(now())
  time          String[]
  numberTable   Int      @map("number_table")

  userId Int
  user   User @relation(fields: [userId], references: [id])

  comboMenuId Int
  comboMenu   ComboMenu @relation(fields: [comboMenuId], references: [id])

  comboCustomizedId Int
  comboCustomized   CustomizedComboMenu @relation(fields: [comboCustomizedId], references: [id])

  service   Service @relation(fields: [serviceId], references: [id])
  serviceId Int

  statusBooking STATUS_BOOKING @default(PENDING)

  zoneId Int
  zone   Zone @relation(fields: [zoneId], references: [id])

  feedback Feedback?

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("booking")
}

//6
model ComboMenu {
  id          Int      @id @default(autoincrement())
  comboName   String
  description String
  totalPrice  Decimal? @db.Decimal(60, 2)

  bookings             Booking[]
  comboItems           ComboItem[]
  customizedComboMenus CustomizedComboMenu[]

  service   Service @relation(fields: [serviceId], references: [id])
  serviceId Int

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("combo_menus")
}

model CustomizedComboMenu {
  id     Int  @id @default(autoincrement())
  userId Int
  user   User @relation(fields: [userId], references: [id])

  comboMenuId Int
  comboMenu   ComboMenu   @relation(fields: [comboMenuId], references: [id])
  bookings    Booking[]
  comboItems  ComboItem[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("customized_combo_menus")
}

model ComboItem {
  id         Int     @id @default(autoincrement())
  quantity   Int
  totalPrice Decimal @db.Decimal(60, 2)

  menuItemId Int
  menuItem   MenuItem @relation(fields: [menuItemId], references: [id])

  comboMenuId Int?
  combomenu   ComboMenu? @relation(fields: [comboMenuId], references: [id])

  comboCustomizedMenuId Int?
  customizedComboMenu   CustomizedComboMenu? @relation(fields: [comboCustomizedMenuId], references: [id])

  status STATUS_COMBO @default(AVAILABLE)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("combo_items")
}

//7
model MenuItem {
  id          Int     @id @default(autoincrement())
  dishName    String
  description String?
  price       Decimal @db.Decimal(60, 2)
  image       String?

  typeId   Int
  typeDish TypeDish @relation(fields: [typeId], references: [id])

  comboItems ComboItem[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("menu_item")
}

//8
model TypeDish {
  id       Int    @id @default(autoincrement())
  typeName String

  menuItems MenuItem[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("type_dish")
}

//10
model Service {
  id          Int     @id @default(autoincrement())
  serviceName String
  capacity    Int
  price       Decimal @db.Decimal(60, 2)
  image       String? @default("https://img.freepik.com/free-vector/young-waitress-waiter-object-element-professional-service-restaurant_24797-2133.jpg")

  bookings Booking[]

  comboMenus ComboMenu[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("services")
}

//11
model RestaurantInformation {
  id          Int    @id @default(autoincrement())
  filed       String
  description String

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("restaurant_information")
}

//===================== ENUM ======================

enum GENDER_ENUM_TYPE {
  MALE
  FEMALE
  OTHER
}

enum ROLE {
  ADMIN
  CUSTOMER
}

enum POSITION_ENUM {
  CHEF
  STAFF
}

enum STATUS_COMBO {
  CUSTOMIZED
  AVAILABLE
}

enum STATUS_BOOKING {
  APPROVED
  PENDING
}
